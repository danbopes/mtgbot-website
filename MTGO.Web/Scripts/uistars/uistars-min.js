(function(e){e.widget("ui.stars",{options:{inputType:"radio",split:0,disabled:!1,cancelTitle:"Cancel Rating",cancelValue:0,cancelShow:!0,disableValue:!0,oneVoteOnly:!1,showTitles:!1,captionEl:null,callback:null,starWidth:16,cancelClass:"ui-stars-cancel",starClass:"ui-stars-star",starOnClass:"ui-stars-star-on",starHoverClass:"ui-stars-star-hover",starDisabledClass:"ui-stars-star-disabled",cancelHoverClass:"ui-stars-cancel-hover",cancelDisabledClass:"ui-stars-cancel-disabled"},_create:function(){function i(e,r){if(e!=-1){var i=r?n.starHoverClass:n.starOnClass,u=r?n.starOnClass:n.starHoverClass;t.$stars.eq(e).prevAll("."+n.starClass).andSelf().removeClass(u).addClass(i);t.$stars.eq(e).nextAll("."+n.starClass).removeClass(n.starHoverClass+" "+n.starOnClass);t._showCap(n.id2title[e])}else s()}function s(){t.$stars.removeClass(n.starOnClass+" "+n.starHoverClass);t._showCap("")}var t=this,n=this.options,r=0;this.element.data("former.stars",this.element.html());n.isSelect=n.inputType=="select";this.$form=e(this.element).closest("form");this.$selec=n.isSelect?e("select",this.element):null;this.$rboxs=n.isSelect?e("option",this.$selec):e(":radio",this.element);this.$stars=this.$rboxs.map(function(i){var s={value:this.value,title:(n.isSelect?this.text:this.title)||this.value,isDefault:n.isSelect&&this.defaultSelected||this.defaultChecked};if(i==0){n.split=typeof n.split!="number"?0:n.split;n.val2id=[];n.id2val=[];n.id2title=[];n.name=n.isSelect?t.$selec.get(0).name:this.name;n.disabled=n.disabled||(n.isSelect?e(t.$selec).attr("disabled"):e(this).attr("disabled"))}if(s.value==n.cancelValue){n.cancelTitle=s.title;return null}n.val2id[s.value]=r;n.id2val[r]=s.value;n.id2title[r]=s.title;if(s.isDefault){n.checked=r;n.value=n.defaultValue=s.value;n.title=s.title}var u=e("<div/>").addClass(n.starClass),a=e("<a/>").attr("title",n.showTitles?s.title:"").text(s.value);if(n.split){var f=r%n.split,l=Math.floor(n.starWidth/n.split);u.width(l);a.css("margin-left","-"+f*l+"px")}r++;return u.append(a).get(0)});n.items=r;n.isSelect?this.$selec.remove():this.$rboxs.remove();this.$cancel=e("<div/>").addClass(n.cancelClass).append(e("<a/>").attr("title",n.showTitles?n.cancelTitle:"").text(n.cancelValue));n.cancelShow&=!n.disabled&&!n.oneVoteOnly;n.cancelShow&&this.element.append(this.$cancel);this.element.append(this.$stars);if(n.checked===undefined){n.checked=-1;n.value=n.defaultValue=n.cancelValue;n.title=""}this.$value=e("<input type='hidden' name='"+n.name+"' value='"+n.value+"' />");this.element.append(this.$value);this.$stars.bind("click.stars",function(e){if(!n.forceSelect&&n.disabled)return!1;var r=t.$stars.index(this);n.checked=r;n.value=n.id2val[r];n.title=n.id2title[r];t.$value.attr({disabled:n.disabled?"disabled":"",value:n.value});i(r,!1);t._disableCancel();!n.forceSelect&&t.callback(e,"star")}).bind("mouseover.stars",function(){if(n.disabled)return!1;var e=t.$stars.index(this);i(e,!0)}).bind("mouseout.stars",function(){if(n.disabled)return!1;i(t.options.checked,!1)});this.$cancel.bind("click.stars",function(e){if(!n.forceSelect&&(n.disabled||n.value==n.cancelValue))return!1;n.checked=-1;n.value=n.cancelValue;n.title="";t.$value.val(n.value);n.disableValue&&t.$value.attr({disabled:"disabled"});s();t._disableCancel();!n.forceSelect&&t.callback(e,"cancel")}).bind("mouseover.stars",function(){if(t._disableCancel())return!1;t.$cancel.addClass(n.cancelHoverClass);s();t._showCap(n.cancelTitle)}).bind("mouseout.stars",function(){if(t._disableCancel())return!1;t.$cancel.removeClass(n.cancelHoverClass);t.$stars.triggerHandler("mouseout.stars")});this.$form.bind("reset.stars",function(){!n.disabled&&t.select(n.defaultValue)});e(window).unload(function(){t.$cancel.unbind(".stars");t.$stars.unbind(".stars");t.$form.unbind(".stars");t.$selec=t.$rboxs=t.$stars=t.$value=t.$cancel=t.$form=null});this.select(n.value);n.disabled&&this.disable()},_disableCancel:function(){var e=this.options,t=e.disabled||e.oneVoteOnly||e.value==e.cancelValue;t?this.$cancel.removeClass(e.cancelHoverClass).addClass(e.cancelDisabledClass):this.$cancel.removeClass(e.cancelDisabledClass);this.$cancel.css("opacity",t?.5:1);return t},_disableAll:function(){var e=this.options;this._disableCancel();e.disabled?this.$stars.filter("div").addClass(e.starDisabledClass):this.$stars.filter("div").removeClass(e.starDisabledClass)},_showCap:function(e){var t=this.options;t.captionEl&&t.captionEl.text(e)},value:function(){return this.options.value},select:function(e){var t=this.options,n=e==t.cancelValue?this.$cancel:this.$stars.eq(t.val2id[e]);t.forceSelect=!0;n.triggerHandler("click.stars");t.forceSelect=!1},selectID:function(e){var t=this.options,n=e==-1?this.$cancel:this.$stars.eq(e);t.forceSelect=!0;n.triggerHandler("click.stars");t.forceSelect=!1},enable:function(){this.options.disabled=!1;this._disableAll()},disable:function(){this.options.disabled=!0;this._disableAll()},destroy:function(){this.$form.unbind(".stars");this.$cancel.unbind(".stars").remove();this.$stars.unbind(".stars").remove();this.$value.remove();this.element.unbind(".stars").html(this.element.data("former.stars")).removeData("stars");return this},callback:function(e,t){var n=this.options;n.callback&&n.callback(this,t,n.value,e);n.oneVoteOnly&&!n.disabled&&this.disable()}});e.extend(e.ui.stars,{version:"3.0.1"})})(jQuery);